name: CF KV Create (make FCANEWS_KV)

on:
  workflow_dispatch: {}

jobs:
  create-kv:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-node@v4
        with:
          node-version: "20"

      - name: Install Wrangler v4
        run: npm i -g wrangler@4

      - name: Whoami (sanity)
        run: wrangler whoami
        env:
          CLOUDFLARE_API_TOKEN: ${{ secrets.CF_API_TOKEN }}

      # 1) 네임스페이스 생성 (이미 있으면 에러가 날 수 있음)
      - name: Create namespace FCANEWS_KV
        run: wrangler kv namespace create FCANEWS_KV || true
        env:
          CLOUDFLARE_API_TOKEN: ${{ secrets.CF_API_TOKEN }}
          CF_ACCOUNT_ID: ${{ secrets.CF_ACCOUNT_ID }}

      # 2) 목록에서 ID 확인
      - name: List namespaces (grab ID)
        run: wrangler kv namespace list
        env:
          CLOUDFLARE_API_TOKEN: ${{ secrets.CF_API_TOKEN }}
          CF_ACCOUNT_ID: ${{ secrets.CF_ACCOUNT_ID }}

      # (선택) 빠른 검색
      - name: Quick grep
        run: wrangler kv namespace list | grep -i FCANEWS_KV || true
        env:
          CLOUDFLARE_API_TOKEN: ${{ secrets.CF_API_TOKEN }}
          CF_ACCOUNT_ID: ${{ secrets.CF_ACCOUNT_ID }}

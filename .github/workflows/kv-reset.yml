name: CF KV Reset (last_* keys)

on:
  workflow_dispatch: {}

jobs:
  reset-kv:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Use Node
        uses: actions/setup-node@v4
        with:
          node-version: "20"

      - name: Install Wrangler v4
        run: npm i -g wrangler@4

      - name: Check Wrangler version
        run: wrangler --version

      # ✅ v4 문법: wrangler kv key delete --binding=... <key>
      - name: Delete last_sent_target_iso
        run: wrangler kv key delete --binding=FCANEWS_KV last_sent_target_iso || true
        env:
          CLOUDFLARE_API_TOKEN: ${{ secrets.CF_API_TOKEN }}
          CF_ACCOUNT_ID: ${{ secrets.CF_ACCOUNT_ID }}

      - name: Delete last_checked_time_iso
        run: wrangler kv key delete --binding=FCANEWS_KV last_checked_time_iso || true
        env:
          CLOUDFLARE_API_TOKEN: ${{ secrets.CF_API_TOKEN }}
          CF_ACCOUNT_ID: ${{ secrets.CF_ACCOUNT_ID }}

      - name: List keys (verify)
        run: wrangler kv key list --binding=FCANEWS_KV
        env:
          CLOUDFLARE_API_TOKEN: ${{ secrets.CF_API_TOKEN }}
          CF_ACCOUNT_ID: ${{ secrets.CF_ACCOUNT_ID }}

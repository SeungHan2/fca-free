name: CF KV Namespaces (list)

on:
  workflow_dispatch: {}   # 수동 실행

jobs:
  list-kv:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Use Node
        uses: actions/setup-node@v4
        with:
          node-version: "20"

      - name: Install Wrangler v4
        run: npm i -g wrangler@4

      - name: Show Wrangler version
        run: wrangler --version

      # ✅ 네임스페이스 전체 목록 출력
      - name: List KV namespaces
        run: wrangler kv namespace list
        env:
          CLOUDFLARE_API_TOKEN: ${{ secrets.CF_API_TOKEN }}
          CF_ACCOUNT_ID: ${{ secrets.CF_ACCOUNT_ID }}

      # (선택) 특정 바인딩이 wrangler.toml과 매칭되는지 빠르게 점검
      - name: Quick grep for FCANEWS_KV
        run: wrangler kv namespace list | grep -i FCANEWS_KV || true
        env:
          CLOUDFLARE_API_TOKEN: ${{ secrets.CF_API_TOKEN }}
          CF_ACCOUNT_ID: ${{ secrets.CF_ACCOUNT_ID }}
